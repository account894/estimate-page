<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ë‹¨ê°€ ìë™ ë§¤ì¹­ ì‹œìŠ¤í…œ</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/xlsx/dist/xlsx.full.min.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600&family=Noto+Sans+KR:wght@400;700&display=swap');
        body { font-family: 'Noto Sans KR', 'Inter', sans-serif; }
        .log-container::-webkit-scrollbar { width: 6px; }
        .log-container::-webkit-scrollbar-thumb { background-color: #cbd5e1; border-radius: 3px; }
        .btn-text-shadow { text-shadow: 0 1px 2px rgba(0,0,0,0.2); }
        .animate-pulse-slow { animation: pulse 3s cubic-bezier(0.4, 0, 0.6, 1) infinite; }
    </style>
</head>
<body class="bg-slate-50 min-h-screen p-4 md:p-8">

    <div class="max-w-6xl mx-auto">
        <header class="mb-8 text-center">
            <h1 class="text-3xl font-bold text-slate-800 mb-2">ë‹¨ê°€ ìë™ ë§¤ì¹­ ë„êµ¬ v5.1</h1>
            <p class="text-slate-600 font-medium text-indigo-600">ë°ì´í„°ì§€ì› â€¢ ì§€ëŠ¥í˜• ìœ ì‚¬ë„ ë§¤ì¹­ â€¢ ì—‘ì…€ ì €ì¥ ìµœì í™”</p>
        </header>

        <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
            <!-- 1. ì„¤ì • ë° ì—…ë¡œë“œ -->
            <div class="md:col-span-1 space-y-6">

                <!-- ì‹œíŠ¸ ì„ íƒ (10ê°œë¡œ í™•ì¥ë¨) -->
                <div class="bg-white p-6 rounded-2xl shadow-sm border border-slate-200 transition-all hover:shadow-md">
                    <h2 class="text-lg font-semibold mb-4 text-slate-700 flex items-center">
                        <span class="w-2 h-6 bg-indigo-500 rounded-full mr-2"></span>
                        DB ì‹œíŠ¸ ì„ íƒ
                    </h2>
                    <select id="sheetSelect" class="w-full border border-slate-300 rounded-lg p-2 focus:ring-2 focus:ring-indigo-500 outline-none transition-all">
                        <option value="2025ë…„">2025ë…„ ë‹¨ê°€í‘œ</option>
                        <option value="ì„¸í•œ">í˜‘ë ¥ì‚¬ í†µí•©ë‹¨ê°€</option>
                        <option value="ckwë‹¨ê°€(ì—…ëƒì˜ˆì •)">CKW ì „ìš©ë‹¨ê°€</option>
                        <option value="Sheet4">ì¶”ê°€ ì‹œíŠ¸ 4</option>
                        <option value="Sheet5">ì¶”ê°€ ì‹œíŠ¸ 5</option>
                        <option value="Sheet6">ì¶”ê°€ ì‹œíŠ¸ 6</option>
                        <option value="Sheet7">ì¶”ê°€ ì‹œíŠ¸ 7</option>
                        <option value="Sheet8">ì¶”ê°€ ì‹œíŠ¸ 8</option>
                        <option value="Sheet9">ì¶”ê°€ ì‹œíŠ¸ 9</option>
                        <option value="Sheet10">ì¶”ê°€ ì‹œíŠ¸ 10</option>
                    </select>
                    <div id="dbStatus" class="mt-3 text-sm text-amber-600 font-medium">DB ìƒíƒœ: ë¡œë“œ ì „</div>
                </div>

                <!-- íŒŒì¼ ì—…ë¡œë“œ -->
                <div class="bg-white p-6 rounded-2xl shadow-sm border border-slate-200 transition-all hover:shadow-md">
                    <h2 class="text-lg font-semibold mb-4 text-slate-700 flex items-center">
                        <span class="w-2 h-6 bg-blue-500 rounded-full mr-2"></span>
                        íŒŒì¼ ì—…ë¡œë“œ (Target)
                    </h2>
                    <div class="relative group">
                        <input type="file" id="excelFile" accept=".xlsx, .xls, .csv" 
                            class="block w-full text-sm text-slate-500 file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-sm file:font-semibold file:bg-indigo-50 file:text-indigo-700 hover:file:bg-indigo-100 transition-all cursor-pointer border border-dashed border-slate-300 rounded-lg p-4">
                    </div>
                    <p class="mt-2 text-xs text-slate-400">â€» ì²« í–‰ì€ ì œëª©í–‰(í’ˆëª…, ê·œê²©, ë‹¨ìœ„...)ì´ì–´ì•¼ í•©ë‹ˆë‹¤.</p>
                </div>

                <!-- ì‹¤í–‰ ë²„íŠ¼ -->
                <div class="bg-white p-6 rounded-2xl shadow-sm border border-slate-200 transition-all hover:shadow-md">
                    <h2 class="text-lg font-semibold mb-4 text-slate-700 flex items-center">
                        <span class="w-2 h-6 bg-emerald-500 rounded-full mr-2"></span>
                        ì‹¤í–‰ ë° ì €ì¥
                    </h2>
                    <div class="flex flex-col gap-3">
                        <button onclick="startWorkerMatch()" id="matchBtn" disabled
                            class="w-full bg-indigo-600 text-white font-semibold py-3 px-4 rounded-xl shadow-lg shadow-indigo-200 hover:bg-indigo-700 disabled:bg-slate-300 disabled:shadow-none transition-all relative overflow-hidden btn-text-shadow border border-indigo-600">
                            âš¡ ê³ ì† ë§¤ì¹­ ì‹¤í–‰
                        </button>
                        <button onclick="downloadExcel()" id="downloadBtn" disabled
                            class="w-full bg-emerald-600 text-white font-semibold py-3 px-4 rounded-xl shadow-lg shadow-emerald-200 hover:bg-emerald-700 disabled:opacity-50 transition-all">
                            ğŸ“¥ ì—‘ì…€ ê²°ê³¼ ì €ì¥
                        </button>
                    </div>
                </div>
            </div>

            <!-- 2. ë¡œê·¸ ë° ì§„í–‰í˜„í™© -->
            <div class="md:col-span-2 space-y-4">
                <div class="bg-slate-900 rounded-2xl p-6 shadow-xl flex flex-col h-[640px] border border-slate-800">
                    <div class="flex justify-between items-center mb-4 border-b border-slate-800 pb-3">
                        <div class="flex items-center gap-2">
                            <div class="w-3 h-3 bg-red-500 rounded-full"></div>
                            <div class="w-3 h-3 bg-yellow-500 rounded-full"></div>
                            <div class="w-3 h-3 bg-green-500 rounded-full"></div>
                            <h2 class="text-slate-400 font-mono text-sm ml-2">SYSTEM MONITOR v5.1</h2>
                        </div>
                        <button onclick="clearLog()" class="text-[11px] text-slate-500 hover:text-white uppercase tracking-widest transition-colors border border-slate-700 px-2 py-1 rounded">Clear Log</button>
                    </div>
                    <div id="log" class="log-container flex-1 text-[13px] font-mono text-indigo-300 overflow-y-auto whitespace-pre-wrap leading-relaxed px-2"></div>
                </div>
            </div>
        </div>
    </div>

    <!-- ëª¨ë‹¬ -->
    <div id="modal" class="fixed inset-0 bg-black/70 hidden items-center justify-center z-50 backdrop-blur-sm">
        <div class="bg-white p-8 rounded-3xl max-w-sm w-full mx-4 shadow-2xl border border-slate-100 scale-95 transition-transform">
            <div class="w-16 h-16 bg-indigo-100 rounded-full flex items-center justify-center mx-auto mb-4">
                <svg class="w-8 h-8 text-indigo-600" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1 v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>
            </div>
            <h3 id="modalTitle" class="text-xl font-bold mb-2 text-slate-800 text-center">ì•Œë¦¼</h3>
            <p id="modalMsg" class="text-slate-600 mb-6 leading-relaxed text-center"></p>
            <button onclick="closeModal()" class="w-full bg-slate-800 text-white py-3 rounded-xl font-semibold hover:bg-slate-700 transition-colors shadow-lg">í™•ì¸</button>
        </div>
    </div>

    <!-- Worker Script -->
    <script id="worker-script" type="javascript/worker">
        const SYNONYM_MAP = {
            "PIPE":"íŒŒì´í”„","ê´€":"íŒŒì´í”„","SPP":"ê°•ê´€","CARBON STEEL":"ê°•ê´€","í‘ê´€":"ê°•ê´€","ë°±ê´€":"ê°•ê´€",
            "SUS":"STS","STAINLESS":"STS","ìŠ¤í…":"STS","ìŠ¤í…Œì¸ë¦¬ìŠ¤":"STS",
            "PVC":"PVC","VG1":"PVC","VG2":"PVC","COPPER":"ë™ê´€","ë™íŒŒì´í”„":"ë™ê´€",
            "PB":"PB","ì—ì´ì½˜":"PB","í´ë¦¬ë¶€í‹¸ë Œ":"PB","CPVC":"CPVC","ì†Œë°©ìš©í•©ì„±ìˆ˜ì§€":"CPVC",
            "PE":"PE","P.E":"PE","HDPE":"PE","SR":"SR","S.R":"SR",
            "FITTING":"ì´ìŒì‡ ","ë¶€ì†":"ì´ìŒì‡ ","ELBOW":"ì—˜ë³´","L":"ì—˜ë³´","ELL":"ì—˜ë³´",
            "TEE":"í‹°","T":"í‹°","REDUCER":"ë ˆë“€ìƒ¤","RED":"ë ˆë“€ìƒ¤","R":"ë ˆë“€ìƒ¤","ì´ê²½ì†Œì¼“":"ë ˆë“€ìƒ¤",
            "SOCKET":"ì†Œì¼“","SOC":"ì†Œì¼“","S":"ì†Œì¼“","COUPLING":"ì†Œì¼“",
            "CAP":"ìº¡","ë§ˆê°œ":"ìº¡","FLANGE":"í”Œëœì§€","FLG":"í”Œëœì§€","F":"í”Œëœì§€",
            "UNION":"ìœ ë‹ˆì˜¨","UN":"ìœ ë‹ˆì˜¨","U":"ìœ ë‹ˆì˜¨","NIPPLE":"ë‹ˆí”Œ","N":"ë‹ˆí”Œ",
            "BUSHING":"ë¶€ì‹±","BUSH":"ë¶€ì‹±","ADAPTER":"ì•„ë‹µíƒ€","M.A":"ì•„ë‹µíƒ€","F.A":"ì•„ë‹µíƒ€","ADPT":"ì•„ë‹µíƒ€",
            "CROSS":"í¬ë¡œìŠ¤","X":"í¬ë¡œìŠ¤","SADDLE":"ìƒˆë“¤","PLUG":"í”ŒëŸ¬ê·¸","ë©”ê¾¸ë¼":"í”ŒëŸ¬ê·¸",
            "VALVE":"ë°¸ë¸Œ","V/V":"ë°¸ë¸Œ","V.V":"ë°¸ë¸Œ","GATE":"ê²Œì´íŠ¸","ì œìˆ˜ë³€":"ê²Œì´íŠ¸",
            "GLOBE":"ê¸€ë¡œë¸Œ","ìŠ¤í†±ë°¸ë¸Œ":"ê¸€ë¡œë¸Œ","CHECK":"ì²´í¬","íŒì²´í¬":"ì²´í¬","ìŠ¤ìœ™ì²´í¬":"ì²´í¬",
            "BALL":"ë³¼","ë³¼ë°¸ë¸Œ":"ë³¼","BUTTERFLY":"ë²„í„°í”Œë¼ì´","B.F":"ë²„í„°í”Œë¼ì´",
            "BFV":"ë²„í„°í”Œë¼ì´","STRAINER":"ìŠ¤íŠ¸ë ˆì´ë„ˆ","STR":"ìŠ¤íŠ¸ë ˆì´ë„ˆ","Y-STR":"ìŠ¤íŠ¸ë ˆì´ë„ˆ",
            "AIR VENT":"ì—ì–´ë²¤íŠ¸","A.V":"ì—ì–´ë²¤íŠ¸","í†µê¸°":"ì—ì–´ë²¤íŠ¸","SAFETY":"ì•ˆì „ë³€"
        };

        const INCOMPATIBLE_GROUPS = [
            ["STS","ìŠ¤í…","SUS"],["ê°•ê´€","SPP","ë°±ê´€","í‘ê´€"],["PVC","VG1","VG2"],
            ["ë™ê´€","COPPER"],["PB","ì—ì´ì½˜"],["CPVC"],
            ["ë°¸ë¸Œ","V/V","ê²Œì´íŠ¸","ê¸€ë¡œë¸Œ","ì²´í¬","ë³¼","ë²„í„°í”Œë¼ì´","ìŠ¤íŠ¸ë ˆì´ë„ˆ"],
            ["ì—˜ë³´","í‹°","ë ˆë“€ìƒ¤","ì†Œì¼“","ìº¡","ìœ ë‹ˆì˜¨","ë¶€ì‹±","ë‹ˆí”Œ","í”Œëœì§€"]
        ];

        const synKeys = Object.keys(SYNONYM_MAP).sort((a,b)=>b.length-a.length);
        const synRegex = new RegExp(synKeys.join("|"),"gi");

        function norm(v){ 
            if(!v) return ""; 
            let str = v.toString().toUpperCase().trim(); 
            str = str.replace(synRegex, (m) => SYNONYM_MAP[m.toUpperCase()] || m); 
            return str.replace(/[^A-Z0-9ê°€-í£]/g, "").replace(/EA|EACH|ê°œ/g, ""); 
        }

        function isCategoryMismatch(src, tgt){ 
            for(let i=0; i<INCOMPATIBLE_GROUPS.length; i++){ 
                const group = INCOMPATIBLE_GROUPS[i]; 
                let srcHas = false, tgtHas = false; 
                for(let k=0; k<group.length; k++){ 
                    if(src.includes(group[k])) srcHas = true; 
                    if(tgt.includes(group[k])) tgtHas = true; 
                    if(srcHas && tgtHas) break;
                } 
                if(srcHas && tgtHas) return false; 
            } 
            return false; 
        }

        function calculateScore(srcText, tgtText) {
            if(!srcText || !tgtText) return 0;
            if(srcText === tgtText) return 100;
            if(tgtText.includes(srcText) || srcText.includes(tgtText)) return 85;
            let matchCount = 0;
            for(let i=0; i < srcText.length - 1; i++) {
                const chunk = srcText.substring(i, i+2);
                if(tgtText.includes(chunk)) matchCount++;
            }
            const score = (matchCount / Math.max(srcText.length, tgtText.length)) * 100;
            return Math.min(score, 90);
        }

        self.onmessage = function(e) {
            const { type, csvRows, dbRows } = e.data;
            if(type !== 'START') return;

            const resultRows = [];
            let conflictCount = 0;
            const total = csvRows.length;
            let lastPercent = 0;

            const processedDB = dbRows.map(row => ({
                original: row,
                normName: norm(row.A), 
                normSpec: norm(row.B)
            }));

            for(let i=0; i < total; i++) {
                const percent = Math.floor((i / total) * 100);
                if(percent > lastPercent) {
                    self.postMessage({ type: 'PROGRESS', percent });
                    lastPercent = percent;
                }

                const row = csvRows[i];
                const srcName = row[0] || ""; 
                const srcSpec = row[1] || ""; 
                const srcUnit = row[2] || ""; 
                const srcMat = row[3] || 0;
                const srcLab = row[4] || 0;

                const nName = norm(srcName);
                const nSpec = norm(srcSpec);

                if(!nName && !nSpec) {
                    resultRows.push([...row.slice(0,5), "", "", "", "", "", "", "", "", "", ""]);
                    continue;
                }

                let candidates = [];
                for(let j=0; j < processedDB.length; j++) {
                    const dbItem = processedDB[j];
                    if(isCategoryMismatch(nName, dbItem.normName)) continue;

                    const nameScore = calculateScore(nName, dbItem.normName);
                    const specScore = calculateScore(nSpec, dbItem.normSpec);
                    const totalScore = (nameScore * 0.5) + (specScore * 0.5);

                    if(totalScore > 20) { 
                        candidates.push({ score: totalScore, item: dbItem.original });
                    }
                }

                candidates.sort((a,b) => b.score - a.score);

                const c1 = candidates[0] ? candidates[0].item : {};
                const c2 = candidates[1] ? candidates[1].item : {};

                resultRows.push([
                    srcName, srcSpec, srcUnit, srcMat, srcLab,
                    c1.A || "", c1.B || "", c1.C || "", c1.D || "", c1.E || "",
                    c2.A || "", c2.B || "", c2.C || "", c2.D || "", c2.E || ""
                ]);

                if(candidates.length > 1 && (candidates[0].score - candidates[1].score < 5)) {
                    conflictCount++;
                }
            }

            self.postMessage({ type: 'COMPLETE', resultRows, conflictCount });
        };
    </script>

    <script>
        let dbRows = [];
        let csvRows = [];
        let worker = null;
        let resultRows = [];

        const logEl = document.getElementById("log");
        const matchBtn = document.getElementById("matchBtn");
        const downloadBtn = document.getElementById("downloadBtn");
        const dbStatus = document.getElementById("dbStatus");
        const sheetSelect = document.getElementById("sheetSelect");

        function initWorker() {
            const blob = new Blob([document.getElementById('worker-script').textContent], { type: "text/javascript" });
            const workerUrl = URL.createObjectURL(blob);
            worker = new Worker(workerUrl);

            worker.onmessage = function(e) {
                const { type, percent, resultRows: res, conflictCount } = e.data;
                if(type === 'PROGRESS') {
                    matchBtn.style.background = `linear-gradient(to right, #10b981 ${percent}%, #4f46e5 ${percent}%)`;
                    matchBtn.textContent = `âš™ï¸ ì²˜ë¦¬ ì¤‘... ${percent}%`;
                } else if(type === 'COMPLETE') {
                    resultRows = res;
                    addLog(`[ì™„ë£Œ] ë§¤ì¹­ ì‘ì—…ì´ ëë‚¬ìŠµë‹ˆë‹¤. (ê²€í† í•„ìš”: ${conflictCount}ê±´)`, 'success');
                    matchBtn.disabled = false;
                    matchBtn.style.background = '';
                    matchBtn.textContent = 'âš¡ ê³ ì† ë§¤ì¹­ ì‹¤í–‰';
                    downloadBtn.disabled = false;
                    showMessage("ì‘ì—… ì™„ë£Œ", `ì´ ${res.length}í–‰ì˜ ë§¤ì¹­ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤.\ní›„ë³´ê°„ ì ìˆ˜ì°¨ê°€ ì ì€ í•­ëª©ì€ ${conflictCount}ê±´ì…ë‹ˆë‹¤.`);
                }
            };
        }

        function addLog(msg, type='info') {
            const time = new Date().toLocaleTimeString('ko-KR', {hour12:false});
            const div = document.createElement('div');
            div.className = "mb-1";
            let color = "text-indigo-300";
            let icon = "Â»";
            if(type === 'success') { color = "text-emerald-400"; icon = "âœ“"; }
            if(type === 'error') { color = "text-rose-400"; icon = "âœ—"; }
            div.innerHTML = `<span class="text-slate-600 mr-2">[${time}]</span><span class="${color}">${icon} ${msg}</span>`;
            logEl.appendChild(div);
            logEl.scrollTop = logEl.scrollHeight;
        }

        function clearLog() { logEl.innerHTML=""; addLog("ì‹œìŠ¤í…œ ëª¨ë‹ˆí„° ì´ˆê¸°í™”ë¨."); }
        
        function showMessage(title, msg){
            document.getElementById("modalTitle").textContent = title;
            document.getElementById("modalMsg").textContent = msg;
            document.getElementById("modal").classList.remove("hidden");
            document.getElementById("modal").classList.add("flex");
        }
        function closeModal(){
            document.getElementById("modal").classList.add("hidden");
            document.getElementById("modal").classList.remove("flex");
        }

        async function fetchDB(){
            const sheetName = sheetSelect.value;
            const SPREADSHEET_ID = "1GaUzextj8jdry2iegBK7EiWDm1VASX8od3o9tP7DoZU";
            const DB_URL = `https://opensheet.elk.sh/${SPREADSHEET_ID}/${encodeURIComponent(sheetName)}`;
            
            matchBtn.disabled = true;
            dbStatus.textContent = "âŒ› ë°ì´í„°ë² ì´ìŠ¤ ì—°ê²° ì¤‘...";
            dbStatus.className = "mt-3 text-sm text-indigo-500 font-medium animate-pulse";
            
            try{
                const res = await fetch(DB_URL);
                if(!res.ok) throw new Error("ë„¤íŠ¸ì›Œí¬ ì˜¤ë¥˜");
                const data = await res.json();
                
                dbRows = data.map(r=>({
                    A: r["í’ˆëª…"]||"", B: r["ê·œê²©"]||"", C: r["ë‹¨ìœ„"]||"",
                    D: String(r["ì¬ë£Œë¹„"]||"0").replace(/,/g,""),
                    E: String(r["ë…¸ë¬´ë¹„"]||"0").replace(/,/g,"")
                }));
                
                dbStatus.innerHTML = `âœ“ DB ë¡œë“œ ì™„ë£Œ (${dbRows.length.toLocaleString()}ê±´)`;
                dbStatus.className = "mt-3 text-sm text-emerald-600 font-bold";
                addLog(`DB ë™ê¸°í™” ì„±ê³µ: ${sheetName} (${dbRows.length}í–‰)`, 'success');
                if(csvRows.length > 0) matchBtn.disabled = false;
            } catch(err){
                dbStatus.textContent = "âŒ DB ë¡œë“œ ì‹¤íŒ¨ (ì¸í„°ë„· í™•ì¸)";
                dbStatus.className = "mt-3 text-sm text-rose-600 font-bold";
                addLog("DB ë¡œë”© ì—ëŸ¬: " + err.message, 'error');
            }
        }

        sheetSelect.addEventListener("change", fetchDB);

        document.getElementById("excelFile").addEventListener("change", e=>{
            const file = e.target.files[0];
            if(!file) return;
            addLog(`íŒŒì¼ ë¡œë“œ ì¤‘: ${file.name}`);
            const reader = new FileReader();
            reader.onload = (evt)=>{
                try{
                    const data = new Uint8Array(evt.target.result);
                    const workbook = XLSX.read(data, {type:'array'});
                    const worksheet = workbook.Sheets[workbook.SheetNames[0]];
                    csvRows = XLSX.utils.sheet_to_json(worksheet, {header:1});
                    addLog(`ë¶„ì„ ì¤€ë¹„ ì™„ë£Œ: ${csvRows.length}í–‰ ë°ì´í„°`, 'success');
                    if(dbRows.length > 0) matchBtn.disabled = false;
                } catch(err){ 
                    addLog("ì—‘ì…€ íŒŒì‹± ì—ëŸ¬: " + err.message, 'error'); 
                }
            };
            reader.readAsArrayBuffer(file);
        });

        function startWorkerMatch(){
            if(csvRows.length < 2) return showMessage("ì˜¤ë¥˜","ì—…ë¡œë“œëœ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.");
            if(dbRows.length === 0) return showMessage("ì˜¤ë¥˜","DBê°€ ì¤€ë¹„ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.");
            addLog("ë°±ê·¸ë¼ìš´ë“œ ë§¤ì¹­ í”„ë¡œì„¸ìŠ¤ ì‹œì‘...");
            matchBtn.disabled = true;
            downloadBtn.disabled = true;
            const contentRows = csvRows.slice(1);
            worker.postMessage({ type:'START', csvRows: contentRows, dbRows: dbRows });
        }

        function downloadExcel(){
            if(!resultRows.length) return;
            const header = [
                "ì›ë³¸_í’ˆëª…","ì›ë³¸_ê·œê²©","ì›ë³¸_ë‹¨ìœ„","ì›ë³¸_ì¬ë£Œë¹„","ì›ë³¸_ë…¸ë¬´ë¹„",
                "í›„ë³´1_í’ˆëª…","í›„ë³´1_ê·œê²©","í›„ë³´1_ë‹¨ìœ„","í›„ë³´1_ì¬ë£Œë¹„","í›„ë³´1_ë…¸ë¬´ë¹„",
                "í›„ë³´2_í’ˆëª…","í›„ë³´2_ê·œê²©","í›„ë³´2_ë‹¨ìœ„","í›„ë³´2_ì¬ë£Œë¹„","í›„ë³´2_ë…¸ë¬´ë¹„"
            ];
            try{
                addLog("ê²°ê³¼ íŒŒì¼ ìƒì„± ì¤‘...");
                const finalData = [header].concat(resultRows);
                const ws = XLSX.utils.aoa_to_sheet(finalData);
                ws['!cols'] = Array(15).fill({wch: 20});
                const wb = XLSX.utils.book_new();
                XLSX.utils.book_append_sheet(wb, ws, "MatchResult");
                const dateStr = new Date().toISOString().slice(0,10).replace(/-/g,"");
                const fileName = `ë§¤ì¹­ê²°ê³¼_${dateStr}.xlsx`;
                XLSX.writeFile(wb, fileName);
                addLog(`ì €ì¥ ì™„ë£Œ: ${fileName}`, 'success');
            } catch(err){ 
                addLog("ì—‘ì…€ ì €ì¥ ì—ëŸ¬: " + err.message, 'error'); 
            }
        }

        initWorker();
        window.onload = () => {
            clearLog();
            fetchDB();
        };
    </script>
</body>
</html>

